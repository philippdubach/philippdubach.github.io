# Submit recently updated URLs to search engines via IndexNow protocol
# Runs daily and after each deployment to notify Bing, Yandex, etc. of changes
name: IndexNow

on:
  # Run after Hugo deployment completes
  workflow_run:
    workflows: ["Deploy Hugo site to Pages"]
    types:
      - completed
  
  # Also run daily to catch any missed updates
  schedule:
    - cron: '0 6 * * *'  # 6 AM UTC daily
  
  # Manual trigger for testing
  workflow_dispatch:

jobs:
  submit-urls:
    runs-on: ubuntu-latest
    # Only run if deployment succeeded (or on schedule/manual trigger)
    if: ${{ github.event_name != 'workflow_run' || github.event.workflow_run.conclusion == 'success' }}
    steps:
      - name: Submit to IndexNow
        # Pinned to v2.1.3 commit SHA for supply chain security
        # Check for updates: https://github.com/bojieyang/indexnow-action/releases
        uses: bojieyang/indexnow-action@b5a6f3e23bcd03a8471acbc7d71c3febb4a0be63 # v2.1.3
        with:
          sitemap-location: 'https://philippdubach.com/sitemap.xml'
          key: ${{ secrets.INDEXNOW_KEY }}
          since: 1
          since-unit: 'day'
          limit: 1000
          endpoint: 'api.indexnow.org'  # Shares with all participating engines
