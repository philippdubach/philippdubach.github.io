{{/* WebSite Schema - Homepage only */}}
{{ if .IsHome }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "{{ .Site.Title }}",
  "url": "{{ .Site.BaseURL }}",
  "description": "{{ .Site.Params.description }}",
  "inLanguage": "{{ .Site.Language.Lang | default "en" }}",
  "publisher": {
    "@type": "Person",
    "name": "{{ .Site.Params.author }}"
  }
}
</script>
{{ end }}

{{/* Person Schema - About page for E-E-A-T signals */}}
{{ if eq .RelPermalink "/about/" }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "{{ .Site.Params.author }}",
  "url": "{{ .Site.BaseURL }}about/",
  {{- $sameAs := slice -}}
  {{- with .Site.Params.social.github }}{{ $sameAs = $sameAs | append (printf "https://github.com/%s" .) }}{{ end -}}
  {{- with .Site.Params.social.bluesky }}{{ $sameAs = $sameAs | append (printf "https://bsky.app/profile/%s" .) }}{{ end -}}
  {{- $sameAs = $sameAs | append "https://scholar.google.com/citations?user=-69oS2wAAAAJ" -}}
  {{- $sameAs = $sameAs | append "https://www.researchgate.net/profile/Philipp-Dubach" -}}
  "sameAs": {{ $sameAs | jsonify }},
  "jobTitle": "Strategy Consultant & Independent Researcher",
  "knowsAbout": {{ .Site.Params.keywords | jsonify }}
}
</script>
{{ end }}

{{/* Research Page Schema - CollectionPage with ScholarlyArticle items */}}
{{ if eq .RelPermalink "/research/" }}
{{ with .Site.Data.research }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "Research",
  "description": "{{ $.Params.description }}",
  "url": "{{ $.Permalink }}",
  "author": {
    "@type": "Person",
    "name": "{{ $.Site.Params.author }}",
    "url": "{{ $.Site.BaseURL }}about/",
    "sameAs": [
      {{ with .profiles.google_scholar }}"{{ . }}"{{ end }}{{ if and .profiles.google_scholar .profiles.researchgate }},{{ end }}
      {{ with .profiles.researchgate }}"{{ . }}"{{ end }}
    ]
  },
  "hasPart": [
    {{- $first := true -}}
    {{- range .publications -}}
      {{- range .items -}}
        {{- if not $first }},{{ end -}}
        {{- $first = false }}
    {
      "@type": "ScholarlyArticle",
      "headline": "{{ .title }}",
      "name": "{{ .title }}",
      {{ with .summary }}"abstract": {{ . | jsonify }},{{ end }}
      "author": {
        "@type": "Person",
        "name": "{{ $.Site.Params.author }}"
      }
      {{ with .doi }},"url": "https://dx.doi.org/{{ . }}"{{ end }}
    }
      {{- end -}}
    {{- end }}
  ]
}
</script>
{{ end }}
{{ end }}

{{/* Breadcrumb Structured Data */}}
{{ if .IsPage }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ .Site.BaseURL }}"
    }
    {{ if .Section }},
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{ .Section | humanize }}",
      "item": "{{ .Site.BaseURL }}{{ .Section }}/"
    }
    {{ end }},
    {
      "@type": "ListItem",
      "position": {{ if .Section }}3{{ else }}2{{ end }},
      "name": "{{ .Title }}",
      "item": "{{ .Permalink }}"
    }
  ]
}
</script>
{{ end }}

{{/* Article Structured Data - Enhanced for GEO */}}
{{ if .IsPage }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "{{ if eq .Params.type "Project" }}TechArticle{{ else if eq .Type "post" }}BlogPosting{{ else }}Article{{ end }}",
  "headline": "{{ .Title }}",
  "name": "{{ .Title }}",
  "description": "{{ if .Description }}{{ .Description }}{{ else }}{{ .Summary | plainify | truncate 160 }}{{ end }}",
  {{ if .Params.keywords }}
  "keywords": [{{ range $i, $keyword := .Params.keywords }}{{ if $i }}, {{ end }}"{{ $keyword }}"{{ end }}],
  {{ else if .Params.tags }}
  "keywords": [{{ range $i, $tag := .Params.tags }}{{ if $i }}, {{ end }}"{{ $tag }}"{{ end }}],
  {{ end }}
  "articleBody": {{ .Content | plainify | jsonify }},
  "wordCount": {{ .WordCount }},
  "timeRequired": "PT{{ .ReadingTime }}M",
  "inLanguage": "{{ .Site.Language.Lang | default "en" }}",
  "speakable": {
    "@type": "SpeakableSpecification",
    "cssSelector": [".post-content > p:first-of-type", ".post-header h1"]
  },
  {{ if eq .Params.type "Project" }}
  "proficiencyLevel": "Expert",
  {{ end }}
  {{ with .Params.external_url }}
  "citation": {
    "@type": "CreativeWork",
    "url": "{{ . }}"
  },
  {{ end }}
  {{ with .Params.doi }}
  "sameAs": "https://doi.org/{{ . }}",
  {{ end }}
  {{ $image := "" }}
  {{ if .Params.images }}
    {{ $image = index .Params.images 0 }}
    {{/* Ensure absolute URL for structured data */}}
    {{ if not (hasPrefix $image "http") }}
      {{ $image = $image | absURL }}
    {{ end }}
  {{ else if .Params.image }}
    {{ $image = .Params.image | absURL }}
  {{ else if .Site.Params.default_image }}
    {{ $image = .Site.Params.default_image }}
  {{ end }}
  {{ if $image }}
  "image": {
    "@type": "ImageObject",
    "url": "{{ $image }}",
    "width": 1200,
    "height": 630
  },
  {{ end }}
  "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
  "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ .Permalink }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ .Site.Title }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ .Site.BaseURL }}icons/web-app-manifest-512x512.png",
      "width": 512,
      "height": 512
    }
  }
  {{ if .Site.Params.author }},
  "author": {
    "@type": "Person",
    "name": "{{ .Site.Params.author }}",
    "url": "{{ .Site.BaseURL }}about/",
    "sameAs": [
      "https://github.com/philippdubach",
      "https://bsky.app/profile/philippdubach.com",
      "https://scholar.google.com/citations?user=-69oS2wAAAAJ"
    ]
  }
  {{ end }}
}
</script>
{{ end }}