{{- $pages := where .Site.RegularPages "Section" "posts" -}}
{{- $pages = $pages | first 50 -}}
{
  "version": "https://jsonfeed.org/version/1.1",
  "title": {{ .Site.Title | jsonify }},
  "home_page_url": {{ .Site.BaseURL | jsonify }},
  "feed_url": {{ "/feed.json" | absURL | jsonify }},
  "description": {{ .Site.Params.description | jsonify }},
  "language": "en-US",
  "icon": {{ "/icons/web-app-manifest-512x512.png" | absURL | jsonify }},
  "favicon": {{ "/icons/favicon.ico" | absURL | jsonify }},
  "authors": [
    {
      "name": {{ .Site.Params.author | jsonify }},
      "url": {{ "/about/" | absURL | jsonify }},
      "avatar": {{ .Site.Params.default_image | jsonify }}
    }
  ],
  "_philippdubach": {
    "about": "Custom extensions for philippdubach.com",
    "research_profiles": {
      "google_scholar": "https://scholar.google.com/citations?user=-69oS2wAAAAJ",
      "researchgate": "https://www.researchgate.net/profile/Philipp-Dubach"
    }
  },
  "items": [
    {{- range $index, $page := $pages }}
    {{- if $index }},{{ end }}
    {
      "id": {{ $page.Permalink | jsonify }},
      "url": {{ $page.Permalink | jsonify }},
      {{- with $page.Params.external_url }}
      "external_url": {{ . | jsonify }},
      {{- end }}
      "title": {{ $page.Title | jsonify }},
      "content_html": {{ $page.Content | replaceRE `(?s)<aside[^>]*class="readnext"[^>]*>.*?</aside>` "" | jsonify }},
      "summary": {{ ($page.Description | default ($page.Summary | plainify | truncate 300)) | jsonify }},
      {{- $image := "" }}
      {{- if $page.Params.images }}
        {{- $image = index $page.Params.images 0 }}
      {{- else if $page.Site.Params.default_image }}
        {{- $image = $page.Site.Params.default_image }}
      {{- end }}
      {{- if $image }}
      "image": {{ $image | jsonify }},
      {{- end }}
      "date_published": {{ $page.Date.Format "2006-01-02T15:04:05Z07:00" | jsonify }},
      "date_modified": {{ $page.Lastmod.Format "2006-01-02T15:04:05Z07:00" | jsonify }},
      "authors": [
        {
          "name": {{ $.Site.Params.author | jsonify }},
          "url": {{ "/about/" | absURL | jsonify }}
        }
      ],
      {{- with $page.Params.categories }}
      "tags": {{ . | jsonify }},
      {{- end }}
      "_philippdubach": {
        "type": {{ $page.Params.type | default "Article" | jsonify }},
        "word_count": {{ $page.WordCount }},
        "reading_time_minutes": {{ $page.ReadingTime }},
        {{- with $page.Params.keywords }}
        "keywords": {{ . | jsonify }},
        {{- end }}
        {{- with $page.Params.doi }}
        "doi": {{ . | jsonify }},
        {{- end }}
        "section": {{ $page.Section | jsonify }}
      }
    }
    {{- end }}
  ]
}
