{{ define "main" }}
<article class="post single">
    <header class="post-header">
        <h1 class="post-title">
            {{ if .Params.external_url }}
                <a href="{{ .Params.external_url }}" target="_blank" rel="noopener">
                    {{ .Title }}
                    <span class="external-link">→</span>
                </a>
            {{ else }}
                {{ .Title }}
            {{ end }}
        </h1>
        {{ if not .Date.IsZero }}
        <div class="post-meta">
            <time datetime="{{ .Date.Format "2006-01-02T15" }}">
                {{ .Date.Format "January 2, 2006" }}
            </time>

            • {{ .FuzzyWordCount }} words
            • {{ .ReadingTime }} min read
                        {{ if .Params.external_url }}
                • <a href="{{ .Params.external_url }}" target="_blank" rel="noopener">Original Link</a>
            {{ end }}
        </div>
        {{ end }}
    </header>
    <div class="post-content">
        {{ .Content }}
    </div>
</article>

<footer class="feedback-footer">
  <p>Have feedback, comments, or ideas? <a href="mailto:info@philippdubach.com">I'd love to hear from you</a>.</p>
  <p class="latest-post">Latest: <a href="{{ (index (where .Site.RegularPages "Section" "posts") 0).RelPermalink }}">{{ (index (where .Site.RegularPages "Section" "posts") 0).Title }}</a></p>
  
  {{ $url := "https://philippdubach.goatcounter.com/api/v0/stats/hits?limit=1" }}
  {{ $opts := dict "headers" (dict "Authorization" (printf "Bearer %s" (getenv "GOATCOUNTER_API_TOKEN"))) }}
  {{ with resources.GetRemote $url $opts }}
    {{ $data := . | transform.Unmarshal }}
    {{ if $data.hits }}
      {{ $topPost := index $data.hits 0 }}
      {{ $title := $topPost.title }}
      {{ $title = index (split $title " - ") 0 }}
      <p class="most-read">Top this week: <a href="{{ $topPost.path }}">{{ $title }}</a></p>
    {{ end }}
  {{ end }}
</footer>

{{ end }}