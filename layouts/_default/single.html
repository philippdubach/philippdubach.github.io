{{ define "main" }}
<article class="post single">
    <header class="post-header">
        <h1 class="post-title">
            {{ .Title }}
        </h1>
        {{ if not .Date.IsZero }}
        <div class="post-meta">
            <time datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
                {{ .Date.Format "January 2, 2006" }}
            </time>
            • {{ .FuzzyWordCount }} words
            • {{ .ReadingTime }} min read
            {{ if .Params.external_url }}
                • <a href="{{ .Params.external_url }}" target="_blank" rel="noopener">via</a>
            {{ end }}
            • <a href="#" id="share-link" title="Copy short link" aria-label="Copy short link" style="text-decoration:none">∞</a>
            <span id="share-status"></span>
        </div>
        {{ end }}
    </header>
    <div class="post-content">
        {{ .Content }}
    </div>
</article>

<footer class="feedback-footer">
  <p>Have feedback, comments, or ideas? <a href="mailto:info@philippdubach.com">I'd love to hear from you</a>.</p>
  <p class="latest-post">Latest: <a href="{{ (index (where .Site.RegularPages "Section" "posts") 0).RelPermalink }}">{{ (index (where .Site.RegularPages "Section" "posts") 0).Title }}</a></p>
  <p class="most-read" id="top-post-week" style="min-height: 1.5em;">
    <!-- Populated by JS -->
  </p>
</footer>

<script src="/js/goatcounter-top.js"></script>
<script>
(function(){
  var link = document.getElementById('share-link');
  var status = document.getElementById('share-status');
  if (!link) return;
  link.addEventListener('click', function(e) {
    e.preventDefault();
    status.textContent = '...';
    var url = encodeURIComponent(window.location.href);
    var cb = 'yourls_' + Date.now();
    window[cb] = function(data) {
      var short = data.shorturl;
      if (short) {
        navigator.clipboard.writeText(short).then(function() {
          status.textContent = 'url copied';
          setTimeout(function() { status.textContent = ''; }, 2000);
        });
      } else {
        status.textContent = 'error';
        setTimeout(function() { status.textContent = ''; }, 2000);
      }
      delete window[cb];
      document.body.removeChild(s);
    };
    var s = document.createElement('script');
    s.src = 'https://pdub.click/yourls-api.php?signature=4807288869&action=shorturl&format=jsonp&callback=' + cb + '&url=' + url;
    document.body.appendChild(s);
  });
})();
</script>

{{ end }}