{{ printf "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?>" | safeHTML }}
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  {{ range .Site.AllPages }}
  {{ if and (not .Draft) (not .Params.private) (not .Params.unlisted) }}
  <url>
    <loc>{{ .Permalink }}</loc>
    {{- $lm := .Lastmod -}}
    {{- if and (.IsHome) (gt (len .Site.RegularPages) 0) -}}
      {{- $candidate := (index (.Site.RegularPages.ByLastmod.Reverse) 0).Lastmod -}}
      {{- if or ($lm.IsZero) ($candidate.After $lm) -}}
        {{- $lm = $candidate -}}
      {{- end -}}
    {{- else if and (or .IsSection (eq .Kind "taxonomy") (eq .Kind "term")) (gt (len .Pages) 0) -}}
      {{- $candidate := (index (.Pages.ByLastmod.Reverse) 0).Lastmod -}}
      {{- if or ($lm.IsZero) ($candidate.After $lm) -}}
        {{- $lm = $candidate -}}
      {{- end -}}
    {{- end -}}
    {{- if and ($lm.IsZero) (not .Date.IsZero) -}}
      {{- $lm = .Date -}}
    {{- end -}}
    {{- if not $lm.IsZero -}}
    <lastmod>{{ $lm.Format "2006-01-02T15:04:05-07:00" | safeHTML }}</lastmod>
    {{- end }}
    <changefreq>{{ if .IsHome }}weekly{{ else if .IsSection }}weekly{{ else }}monthly{{ end }}</changefreq>
    <priority>{{ if .IsHome }}1.0{{ else if .IsSection }}0.8{{ else if .IsPage }}0.6{{ else }}0.5{{ end }}</priority>
  </url>
  {{ end }}
  {{ end }}
</urlset>